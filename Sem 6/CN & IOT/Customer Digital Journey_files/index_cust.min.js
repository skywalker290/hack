var IsAsset;function getRunFlowCust(e){var a=e.utmCampaign,l="Normal",t=null!=e.QueryStringValues?e.QueryStringValues.utmCampaign:"";a=a||(t||"");var o=null!=e.LeadNumber?e.LeadNumber:"";null!=e.DapFormNo&&(e.DapFormNo.startsWith("DPL")||e.DapFormNo.startsWith("DTW")||e.DapFormNo.startsWith("DAL")||e.DapFormNo.startsWith("DCC"))&&(IsAsset="Yes");var n=null!=e.QueryStringValues?e.QueryStringValues.isOnBoard:"",d=null!=e.QueryStringValues?e.QueryStringValues.ChannelPartnerPromoCode:"",s=null!=e.QueryStringValues?e.QueryStringValues.productId:"",r=null!=e.QueryStringValues?e.QueryStringValues.aggregator:"";return l=null!=e.QueryStringValues&&e.QueryStringValues.DapFormNo||null!=e.DapFormNo&&""!=e.DapFormNo?"Customer":null!=e.TrackJourneyType?e.TrackJourneyType:"Normal",d=d||!1,{utmCampaign:a,mcId:e.mcId,utmContent:e.utmContent,utmMedium:e.utmMedium,utmSource:e.utmSource,loginResult:e.loginResult,transactionid:e.transactionid,IsErrorFromService:e.IsErrorFromService,isOnBoard:n,campname:e.campname,segname:e.segname,source:e.source,utmterm:e.utmterm,gclid:e.gclid,cid:e.cid,isCPBanner:e.isCPBanner,CustId:e.CustId,isFromPhoneBanking:e.isFromPhoneBanking,isFromCrosssell:e.isFromCrosssell,IsPayZappIntegration:e.IsPayZappIntegration,isCustomerNew:e.isCustomerNew,ISAACCOUNTNO:e.ISAACCOUNTNO,IsResume:e.IsResume,TrackJourneyType:l,ChannelPartnerPromoCode:d,productId:s,aggregator:r,IsRedirectFromBackbase:e.IsRedirectFromBackbase,isVivid_CI:e.isVivid_CI,isVivid_ISA:e.isVivid_ISA,LeadNumber:o,IsAsset:IsAsset}}function PrepareCustomData(e){var a={};return null!=e&&("NO"==e.IsErrorFromService&&"YES"==e.isFromPhoneBanking&&InitPhoneBankingProps(a,e),"YES"==e.isFromCrosssell&&InitCrosssellProps(a,e),"Yes"==e.IsPayZappIntegration&&GetIntegrationData(a,e),null!=e.QueryStringValues&&null!=e.QueryStringValues.leadid&&UpdateJsonField(a,"ObjectId",e.QueryStringValues.leadid,"value"),"YES"==e.IsRedirectFromBackbase&&(UpdateJsonField(a,"IsRedirectFromBackbase",e.IsRedirectFromBackbase,"value"),UpdateJsonField(a,"postcode",e.postcode,"value"),UpdateJsonField(a,"AccountId",e.AccountId,"value"),UpdateJsonField(a,"SourceID",e.SourceID,"value"),UpdateJsonField(a,"isCustomerNew",e.isCustomerNew,"value")),"Yes"==e.isVivid_CI&&(UpdateJsonField(a,"isVivid_CI",e.isVivid_CI,"value"),UpdateJsonField(a,"transactionid",e.transactionid,"value"),UpdateJsonField(a,"CustId",e.CustId,"value"),UpdateJsonField(a,"isVivid_CI_Backbase",e.isVivid_CI,"value"),UpdateJsonField(a,"cspk",e.cspk,"value")),"No"==e.isVivid_CI&&(UpdateJsonField(a,"isVivid_CI",e.isVivid_CI,"value"),UpdateJsonField(a,"transactionid",e.transactionid,"value"),UpdateJsonField(a,"CustId",e.CustId,"value"),UpdateJsonField(a,"cspk",e.cspk,"value")),"Yes"==e.isVivid_ISA&&(UpdateJsonField(a,"isVivid_ISA",e.isVivid_ISA,"value"),UpdateJsonField(a,"cspk",e.cspk,"value")),"No"==e.isVivid_ISA&&(UpdateJsonField(a,"IsRedirectFromBackbase","YES","value"),UpdateJsonField(a,"isVivid_ISA",e.isVivid_ISA,"value"),UpdateJsonField(a,"cspk",e.cspk,"value")),null!=a&&(null!=e.TrackJourneyType&&UpdateJsonField(a,"TrackJourneyType",e.TrackJourneyType,"selfValue"),IsNullOrEmpty(e.DapFormNo)&&!IsNullOrEmpty(e.LeadId)?UpdateJsonField(a,"TrackJourneyType","Agent","value"):!IsNullOrEmpty(e.DapFormNo)&&IsNullOrEmpty(e.LeadId)&&UpdateJsonField(a,"TrackJourneyType","Customer","value"),null!=e.QueryStringValues&&null!=e.QueryStringValues.LeadId&&UpdateJsonField(a,"ObjectId",e.QueryStringValues.LeadId,"value"),null!=e.CustId&&UpdateJsonField(a,"CustId",IsNullOrEmpty(e.CustId)?"":e.CustId,"value"),null!=e.ISAACCOUNTNO&&UpdateJsonField(a,"ISAACCOUNTNO",IsNullOrEmpty(e.ISAACCOUNTNO)?"":e.ISAACCOUNTNO,"value")),null!=e.isFromLKP&&(UpdateJsonField(a,"LKPReferenceId",e.LKPReferenceId,"value"),UpdateJsonField(a,"LKPLeadID",e.LKPLeadID,"value"),UpdateJsonField(a,"LKPAddressUpdate",e.LKPAddressUpdate,"value"),UpdateJsonField(a,"LKPReturnUrl",e.LKPReturnUrl,"value")),null!=e.IsfromDigitalAadhaar&&(UpdateJsonField(a,"IsfromDigitalAadhaar",e.IsfromDigitalAadhaar,"value"),UpdateJsonField(a,"AadhaarResponse",e.AadhaarResponse,"value"),UpdateJsonField(a,"AadhaarResponseFlag",e.AadhaarResponse.AuthStatus,"value"),UpdateJsonField(a,"AadhaarResponseData",e.AadhaarResponse.Data,"value"),UpdateJsonField(a,"AadhaarResponseConsentLanguage",e.AadhaarResponse.ConsentLanguage,"value")),null!=e.Lienresponse&&UpdateJsonField(a,"Lienresponse",JSON.parse(e.Lienresponse),""),null!=e.ErrorCode&&""!=e.ErrorCode&&UpdateJsonField(a,"ErrorCode",JSON.parse(e.ErrorCode),"value"),null!=e.MYCAMRefNo&&UpdateJsonField(a,"MYCAMRefNo",JSON.parse(e.MYCAMRefNo),"value"),null!=IsAsset&&"Yes"==IsAsset&&UpdateJsonField(a,"IsAsset","Yes","value"),null!=e.CustomerID&&UpdateJsonField(a,"CustomerID",e.CustomerID,"value"),null!=e.Mobile&&UpdateJsonField(a,"Mobile",e.Mobile,"value"),null!=e.BranchCode&&""!=e.BranchCode&&UpdateJsonField(a,"BranchCode",e.BranchCode,"value"),null!=e.LGCode&&""!=e.LGCode&&UpdateJsonField(a,"LGCode",e.LGCode,"value"),null!=e.RoleID&&UpdateJsonField(a,"RoleID",e.RoleID,"value"),null!=e.Filler2&&UpdateJsonField(a,"Filler2",e.Filler2,"value"),"Yes"==e.isFromAdobe&&(UpdateJsonField(a,"isFromAdobe","Yes","value"),UpdateJsonField(a,"MobileNumber",e.Mobile,"value"),UpdateJsonField(a,"source",e.source,"value"),UpdateJsonField(a,"CustId",e.CustId,"value"),UpdateJsonField(a,"DOB",e.DOB,"value"),UpdateJsonField(a,"PanNumber",e.PAN,"value"),UpdateJsonField(a,"PANNumber",e.PAN,"value"),UpdateJsonField(a,"CustType",e.CustType,"value"),UpdateJsonField(a,"AuthenticationFlag",e.AuthFlag,"value"),UpdateJsonField(a,"Product",e.Product,"value"))),a}function InitCrosssellProps(e,a){UpdateJsonField(e,"ProductID",a.ProductId,"value"),UpdateJsonField(e,"CustId",a.CustomerID,"value"),UpdateJsonField(e,"isCustomerNew",a.isCustomerNew,"value"),UpdateJsonField(e,"AccountID",a.CifId,"value"),UpdateJsonField(e,"ServiceName",a.ServiceToBeUsed,"value"),UpdateJsonField(e,"MethodToBeCalled",a.MethodToBeCalled,"value"),UpdateJsonField(e,"MethodToBeCalled1",a.MethodToBeCalled1,"value"),UpdateJsonField(e,"isFromCrosssell",a.isFromCrosssell,"value"),UpdateJsonField(e,"CifId",a.CifId,"value"),UpdateJsonField(e,"ServiceToBeUsed",a.ServiceToBeUsed,"value"),UpdateJsonField(e,"AccountId",a.CifId,"value"),UpdateJsonField(e,"SourceID",a.ServiceToBeUsed,"value")}function InitPhoneBankingProps(e,a){UpdateJsonField(e,"isPhoneBanking","Yes","value"),a&&(UpdateJsonField(e,"MobileNumber",a.MobileNumber,"value"),UpdateJsonField(e,"AlternateMobile",a.AlternateContactNo,"value"),UpdateJsonField(e,"Filler2",a.Filler2,"value"),UpdateJsonField(e,"Filler3",a.Filler3,"value"),UpdateJsonField(e,"Filler4",a.Filler4,"value"),UpdateJsonField(e,"Filler5",a.Filler5,"value"),UpdateJsonField(e,"LeadSourceSystemID",a.LeadSourceSystemId,"value"),UpdateJsonField(e,"OCCSystemID",a.LSS_OCCSystemId,"value"),UpdateJsonField(e,"AuthenticationType",a.AuthenticationType,"value"),UpdateJsonField(e,"AuthenticationFlag",a.AuthenticationFlag,"value"),UpdateJsonField(e,"SourceSystem",a.SourceSystem,"value"),UpdateJsonField(e,"LGCode",a.LGCode,"value"),UpdateJsonField(e,"ChannelText",a.Channel,"value"),UpdateJsonField(e,"Channel",a.ChannelLookupId,"value"),UpdateJsonField(e,"BranchCode",a.BranchCode,"value"),UpdateJsonField(e,"Channel",a.Channel,"txtvalue")),"NO"==a.isCustomerNew&&(UpdateJsonField(e,"CustId",a.CustId,"value"),UpdateJsonField(e,"IsExistingCustomer","Yes","value")),IsNullOrEmpty(a.DapFormNo)&&!IsNullOrEmpty(a.LeadId)?(a.TrackJourneyType="Agent",a.flowName=a.trackAppFlowName,a.runFlowBase.uniqueName=a.trackAppFlowName):!IsNullOrEmpty(a.DapFormNo)&&IsNullOrEmpty(a.LeadId)&&(a.TrackJourneyType="Customer",a.runFlowBase.uniqueName=a.trackAppFlowName,a.flowName=a.trackAppFlowName)}function GetIntegrationData(e,a){if(UpdateJsonField(e,"IsPayZappIntegration","Yes","value"),a){var l=a;UpdateJsonField(e,"IntegrationMobileNo",l.fldMobileno,"value"),UpdateJsonField(e,"IntegrationTransactionDate",l.fldTransactionDate,"value"),UpdateJsonField(e,"IntegrationKyc",l.fldKYC,"value"),UpdateJsonField(e,"IntegrationDOB",l.fldDob,"value"),UpdateJsonField(e,"IntegrationLastName",l.fldLastname,"value"),UpdateJsonField(e,"IntegrationMiddleName",l.fldMiddlename,"value"),UpdateJsonField(e,"IntegrationFirstName",l.fldFirstname,"value"),UpdateJsonField(e,"IntegrationPayZappId",l.fldPayZappId,"value"),UpdateJsonField(e,"IntegrationWibmoRefNo",l.fldWibmoRefNo,"value")}}function UpdateModelOnFetchAndStart(e,a){null!=a.PaymentStatus&&UpdateJsonField(e,"KotakPaymentStatus",a.PaymentStatus,"value")}function InitCommonParams(e,a,l,t,o){UpdateJsonField(e,"IsCaptchaEnable",a.IsCaptchaEnable,"value"),UpdateJsonField(e,"QueryStringValues",IsNullOrEmpty(a.QueryStringValues)?"":a.QueryStringValues,"self"),IsNullOrEmpty(e.CustId)&&UpdateJsonField(e,"CustId",IsNullOrEmpty(a.CustId)?"":a.CustId,"value"),UpdateJsonField(e,"flowId",IsNullOrEmpty(l)?"":l,"self"),UpdateJsonField(e,"flowName",IsNullOrEmpty(t)?"":t,"self"),UpdateJsonField(e,"instanceId",IsNullOrEmpty(o)?"":o,"self"),null!=a.isCPBanner&&""!=a.isCPBanner&&UpdateJsonField(e,"isCPBanner",a.isCPBanner,"value"),a.QueryString&&null!=a.QueryString.isDropOff&&"Yes"==a.QueryString.isDropOff&&(null!=a.QueryString.name&&UpdateJsonField(e,"DropOffName",a.QueryString.name.value,"value"),null!=a.QueryString.city&&UpdateJsonField(e,"DropOffCity",a.QueryString.city.value,"value"),null!=a.QueryString.state&&UpdateJsonField(e,"DropOffState",a.QueryString.state.value,"value"),null!=a.QueryString.email&&UpdateJsonField(e,"DropOffEmail",a.QueryString.email.value,"value"),null!=a.QueryString.branchCode&&UpdateJsonField(e,"DropOffBranchCode",a.QueryString.branchCode.value,"value"),null!=a.QueryString.ProductID&&UpdateJsonField(e,"DropOffProductId",a.QueryString.ProductID.value,"value"),null!=a.QueryString.CAProductID&&UpdateJsonField(e,"CAProductID",a.QueryString.CAProductID.value,"value"),null!=a.QueryString.SAProductId&&UpdateJsonField(e,"SAProductId",a.QueryString.SAProductId.value,"value"),null!=a.QueryString.LeadId&&UpdateJsonField(e,"LeadId",a.QueryString.LeadId.value,"value"),UpdateJsonField(e,"DropOffMobile",a.QueryString.mobile.value,"value")),null!=a.CustsID&&null!=a.Origin&&(UpdateJsonField(e,"CustId",a.CustsID,"value"),UpdateJsonField(e,"Origin",a.Origin,"value")),null!=a.postedData&&null!=a.postedData.CustsID&&null!=a.postedData.Origin&&(UpdateJsonField(e,"CustId",a.postedData.CustsID,"value"),UpdateJsonField(e,"Origin",a.postedData.Origin,"value"))}function UpdateResumeData(e,a,l,t){if(null!=l.Lienresponse&&UpdateJsonField(a,"Lienresponse",JSON.parse(l.Lienresponse),""),null!=l.ErrorCode&&UpdateJsonField(a,"ErrorCode",JSON.parse(l.ErrorCode),"value"),null!=l.MYCAMRefNo&&UpdateJsonField(a,"MYCAMRefNo",JSON.parse(l.MYCAMRefNo),"value"),null!=l.AuthenticationType&&"DebitCard"==l.AuthenticationType)for(var o in l)UpdateJsonField(a,o,l[o],"value");if(e.External.IsAuthenticated&&(UpdateJsonField(a,"IsAuthenticated",e.External.IsAuthenticated,"value"),UpdateJsonField(a,"CustId",e.External.custId,"value")),null!=l.LeadId||null!=e.PageContext){if(n){var n=n.response;UpdateJsonField(a,"DapFormNo",n.DapFormNo,"value")}UpdateJsonField(a,"ObjectId",l.LeadId,"value"),t?t&&(delete e.External.IsExistingCustomer,delete e.External.CustomerType):(UpdateJsonField(a,"IsExistingCustomer",l.IsExistingCustomer,"value"),UpdateJsonField(a,"CustomerType",l.CustomerType,"value")),UpdateJsonField(a,"IsCaptchaEnable",l.IsCaptchaEnable,"value"),UpdateJsonField(a,"Mobile",l.Mobile,"value"),UpdateJsonField(a,"AuthenticationType",l.AuthenticationType,"value"),UpdateJsonField(a,"SoaStatus",l.SoaStatus,"value"),"1"==l.returnCode&&UpdateJsonField(a,"DapFormNo","CC","value")}}function openDropOffWindow(){var e,a,l,t,o,n,d,s,r,i=window.VividFramework.Data.PageData.cursor().getIn(["PageContext","PageData"]).toJS(),u=i.currentStepID;o=i.DapFormNo;var p=i.ObjectId;e=i.ProductID,s=i.SAProductId,d=o.value.slice(0,2),IsNullOrEmpty(e)||"5"!=e.value||(n=IsNullOrEmpty(i.ProductVariant)?e:i.ProductVariant);var m=i.utm_campaign,F=i.utm_content,I=i.utm_medium,v=i.utmce_source,c=i.ChannelPartnerPromoCode;null!=i.FirstName&&(r=i.FirstName),null!=i.FullName&&(r=i.FullName);var C=""!=i.Mobile.value?i.Mobile:i.MobileNumber,J=i.BranchCode;l=i.State,t=i.City,null!=i.Exc_EmailID&&(a=i.Exc_EmailID),null!=i.EmailID&&(a=i.EmailID),null!=i.Email&&(a=i.Email);var U={};if(null!=p&&(U.LeadId=p),null!=e&&(U.ProductID=e),null!=n&&(U.CAProductID=n),null!=s&&(U.SAProductId=s),null==u||"99"!=u){null!=m&&(U.utm_campaign=m),null!=F&&(U.utm_content=F),null!=I&&(U.utm_medium=I),null!=v&&(U.utmce_source=v),null!=c&&(U.promoCode=c),""!=u&&(U.currentStep=u),""!=r&&(U.name=r),""!=C&&(U.mobile=C),null!=a&&(U.email=a),""!=l&&(U.state=l),""!=t&&(U.city=t),""!=J&&(U.branchCode=J),""!=o&&(U.dapFormNo=o),U.isDropOff="Yes",U.DropoffJourneyType=d;var g=document.getElementById("VividRoot").value+"vividflow/Dropoff",y=window.open("about:blank","Dropoff","height=600,width=800,scrollbars=1,resizeable=1,menubar=no,toolbar=no,directories=no,titlebar=no,location=no,status=no"),S='<form id="PostForm" name="PostForm" action='+g+' method="POST" /><input type="hidden" name="Data" value="'+encodeURI(JSON.stringify(U))+'"></form><script language="javascript" type="text/javascript">var vPostForm = document.PostForm;vPostForm.submit();<\/script>';y.document.write(S)}}$(window).on("beforeunload",(function(){var e=window.VividFramework.Data.PageData.cursor().getIn(["PageContext","PageData","DropOffWindowFlag","value"]),a=window.VividFramework.Data.PageData.cursor().getIn(["PageContext","PageData"]).toJS(),l=a.flowName,t=a.DapFormNo.value,o=a.ObjectId.value,n=void 0!==t&&t.startsWith("DSM");(flowUniqueName.toLowerCase().indexOf(flowName.toLowerCase())>-1&&"true"!=e&&"YES"!=isErrFrmService||l.toLowerCase()=="S_Account_NewUIUX".toLowerCase()&&""!=o&&1==n&&"false"==e)&&openDropOffWindow()}));